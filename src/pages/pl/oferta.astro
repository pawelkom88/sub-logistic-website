---
import Layout from "../../layouts/Layout.astro";
import "../../styles/oferta.css";
import {
  getCountryCode,
  getCurrentLanguageTranslation,
} from "../../utils/utils";
import truck1 from "../../assets/images/bus.png";
import truck2 from "../../assets/images/solo.png";
import truck3 from "../../assets/images/platforma.png";
import truck5 from "../../assets/images/standard-1.png";
import truck8 from "../../assets/images/zestaw.png";
import truck9 from "../../assets/images/wywrotka.png";
import mapPl from "../../assets/images/map_pl.webp";
import mapEng from "../../assets/images/map_eng.webp";
import mapDe from "../../assets/images/map_de.webp";
import Image from "astro/components/Image.astro";

const lang = getCountryCode(Astro.url.pathname);
const translations = await getCurrentLanguageTranslation(lang);
const offer = translations?.offer ?? {
  title: "",
  items: [] as { lead: string; text?: string }[],
};
const items = offer?.items ?? ([] as { lead: string; text?: string }[]);
const mid = Math.ceil(items.length / 2);
const group1 = items.slice(0, mid);
const group2 = items.slice(mid);

const transport = translations?.transport ?? {
  heading: "",
  labels: { dimensions: "", payload: "", loading: "", pallets: "", volume: "" },
  vehicles: [] as { title: string; specs?: string[] }[],
};
const vehicles =
  transport.vehicles ?? ([] as { title: string; specs?: string[] }[]);
const truckImages = [
  truck1, // Bus
  truck2, // SOLO
  truck5, // STANDARD
  truck3, // Niskopodwozie
  truck8, // TANDEM
  truck5, // CHŁODNIA
  truck5, // IZOTERMA
  truck5, // MEGA
  truck3, // PLATFORMA
  truck9, // Wywrotka
] as const;

const coverage = translations?.coverage ?? {
  heading: "",
  openAria: "",
  srOpen: "",
  figcaption: "",
  dialogAriaLabel: "",
  dialogClose: "",
};

const truckAltMap = {
  en: "Truck",
  de: "Lastwagen",
  pl: "Ciężarówka",
} as const;

const mapImage = {
  en: mapEng,
  de: mapDe,
  pl: mapPl,
} as const;

const mapAlt = {
  en: "Map of deliveries",
  de: "Karte der Lieferungen",
  pl: "Mapa dostaw",
} as const;
---

<Layout
  contactBtn={translations.contactBtn}
  contact={translations.contact}
  links={translations.nav.links}
  footer={translations.footer}
  title={"Usługi Transportowe Gdańsk - ADR, Chłodniczy, Ponadgabarytowy | Sub Logistic"}
  description={"Kompleksowa oferta transportu z Gdańska: przewozy ADR, chłodniczy i ponadgabarytowy. Piotr Subotowicz – jednoosobowa firma. Szybka wycena, transport na terenie Pomorskiego i całej Europy"}
>
  <section id="why-choose-1662">
    <div class="cs-container">
      <div class="cs-content">
        <h2 class="cs-title">{offer?.title ?? ""}</h2>
      </div>
      <div class="cs-wrapper">
        <ul class="cs-card-group">
          {
            group1.map((item) => (
              <li class="cs-item">
                <span class="cs-item-number">-</span>
                <div class="cs-item-wrapper">
                  <p class="cs-item-text">
                    <strong class="cs-item-lead">{item.lead}</strong>
                    {item.text ? ` ${item.text}` : ""}
                  </p>
                </div>
              </li>
            ))
          }
        </ul>
        <ul class="cs-card-group">
          {
            group2.map((item) => (
              <li class="cs-item">
                <span class="cs-item-number">-</span>
                <div class="cs-item-wrapper">
                  <p class="cs-item-text">
                    <strong class="cs-item-lead">{item.lead}</strong>
                    {item.text ? ` ${item.text}` : ""}
                  </p>
                </div>
              </li>
            ))
          }
        </ul>
      </div>
    </div>
    <br />
    <br />
    <br />
    <div class="cs-container">
      <div class="cs-content">
        <h2 class="cs-title">{transport.heading}</h2>
      </div>
    </div>
    <br />
    <section id="timetable-1731">
      <div class="cs-container">
        <div class="cs-table-list">
          {
            vehicles.map((v, i) => (
              <table class="cs-table">
                <thead>
                  <tr>
                    <th scope="col" colspan="2">
                      {v.title}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="cs-table-row">
                    <td colspan="2">
                      <Image
                        class="truck"
                        width="410"
                        height="150"
                        src={truckImages[i % truckImages.length]}
                        alt={truckAltMap[lang]}
                      />
                    </td>
                    <td class="cs-table-cell">
                      <ul>
                        {v.specs?.map((s) => (
                          <li>{s}</li>
                        ))}
                      </ul>
                    </td>
                  </tr>
                </tbody>
              </table>
            ))
          }
        </div>
      </div>
    </section>
    <br />
    <br />
    <br />
    <div class="cs-container">
      <div class="cs-content">
        <h2 class="cs-title">{coverage.heading}</h2>
      </div>
    </div>
    <br />
    <figure class="map-figure">
      <button
        type="button"
        class="map-open"
        aria-haspopup="dialog"
        aria-controls="map-dialog"
        aria-label={coverage.openAria}
      >
        <Image
          class="map"
          width="1900"
          height="1322"
          src={mapImage[lang]}
          alt={mapAlt[lang]}
        />
        <span class="sr-only">{coverage.srOpen}</span>
      </button>
      <figcaption class="sr-only">{coverage.figcaption}</figcaption>
    </figure>
    <dialog
      id="map-dialog"
      class="map-dialog"
      aria-label={coverage.dialogAriaLabel}
    >
      <div class="map-dialog__content">
        <button
          type="button"
          class="map-dialog__close"
          aria-label={coverage.dialogClose}>{coverage.dialogClose}</button
        >
        <Image
          class="map-dialog__img"
          width="1900"
          height="1322"
          src={mapImage[lang]}
          alt={mapAlt[lang]}
        />
      </div>
    </dialog>
    <script is:inline>
      (function () {
        const btn = document.querySelector(".map-open");
        const dlg = document.getElementById("map-dialog");
        const closeBtn = dlg?.querySelector(".map-dialog__close");
        if (!btn || !dlg || !closeBtn) return;
        btn.addEventListener("click", () => dlg.showModal());
        closeBtn.addEventListener("click", () => dlg.close());
        dlg.addEventListener("click", (e) => {
          if (e.target === dlg) dlg.close();
        });
        dlg.addEventListener("keydown", (e) => {
          if (e.key === "Escape") dlg.close();
        });
      })();
    </script>
  </section>
</Layout>
